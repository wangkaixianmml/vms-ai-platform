from datetime import datetime
from typing import List, Optional
from pydantic import BaseModel, Field

class Asset(BaseModel):
    id: int
    name: str
    ip: Optional[str] = None
    type: str

class Vulnerability(BaseModel):
    id: int
    name: str
    cve_id: Optional[str] = None
    risk_level: str = Field(..., description="漏洞风险等级，例如：高、中、低")
    description: str
    affected_assets: List[Asset] = []
    discovery_date: datetime
    status: str = Field(..., description="漏洞状态，例如：待修复、修复中、已修复、已验证")
    remediation_steps: Optional[str] = None
    
    # 新增字段
    vulnerability_type: Optional[str] = Field(None, description="漏洞类型，例如：SQL注入、XSS、CSRF等")
    vulnerability_url: Optional[str] = Field(None, description="漏洞地址，可能是URL或文件路径")
    responsible_person: Optional[str] = Field(None, description="漏洞负责人")
    department: Optional[str] = Field(None, description="漏洞归属部门")
    first_found_date: Optional[datetime] = Field(None, description="漏洞首次发现时间")
    latest_found_date: Optional[datetime] = Field(None, description="漏洞最近发现时间")
    cvss_score: Optional[float] = Field(None, description="漏洞CVSS评分，0-10")
    vpr_score: Optional[float] = Field(None, description="漏洞VPR评分")
    priority: Optional[str] = Field(None, description="漏洞优先级，例如：高、中、低")
    fix_time_hours: Optional[int] = Field(None, description="漏洞修复时长，单位小时")
    
    # 详情字段，通常在详情页展示
    impact_details: Optional[str] = Field(None, description="漏洞危害详情")
    reproduction_steps: Optional[str] = Field(None, description="漏洞复现步骤")
    affected_components: Optional[str] = Field(None, description="漏洞影响组件")
    impact_scope: Optional[str] = Field(None, description="漏洞影响范围")
    fix_impact: Optional[str] = Field(None, description="漏洞修复影响")
    references: Optional[str] = Field(None, description="漏洞参考资料，可以是链接或文献")
    
class VulnerabilityCreate(BaseModel):
    name: str
    cve_id: Optional[str] = None
    risk_level: str
    description: str
    affected_assets: List[int] = []  # 资产ID列表
    remediation_steps: Optional[str] = None
    
    # 新增字段
    vulnerability_type: Optional[str] = None
    vulnerability_url: Optional[str] = None
    responsible_person: Optional[str] = None
    department: Optional[str] = None
    first_found_date: Optional[datetime] = None
    latest_found_date: Optional[datetime] = None
    cvss_score: Optional[float] = None
    vpr_score: Optional[float] = None
    priority: Optional[str] = None
    fix_time_hours: Optional[int] = None
    
    # 详情字段
    impact_details: Optional[str] = None
    reproduction_steps: Optional[str] = None
    affected_components: Optional[str] = None
    impact_scope: Optional[str] = None
    fix_impact: Optional[str] = None
    references: Optional[str] = None
    
class VulnerabilityUpdate(BaseModel):
    name: Optional[str] = None
    cve_id: Optional[str] = None
    risk_level: Optional[str] = None
    description: Optional[str] = None
    affected_assets: Optional[List[int]] = None
    status: Optional[str] = None
    remediation_steps: Optional[str] = None
    
    # 新增字段
    vulnerability_type: Optional[str] = None
    vulnerability_url: Optional[str] = None
    responsible_person: Optional[str] = None
    department: Optional[str] = None
    first_found_date: Optional[datetime] = None
    latest_found_date: Optional[datetime] = None
    cvss_score: Optional[float] = None
    vpr_score: Optional[float] = None
    priority: Optional[str] = None
    fix_time_hours: Optional[int] = None
    
    # 详情字段
    impact_details: Optional[str] = None
    reproduction_steps: Optional[str] = None
    affected_components: Optional[str] = None
    impact_scope: Optional[str] = None
    fix_impact: Optional[str] = None
    references: Optional[str] = None